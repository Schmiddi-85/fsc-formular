<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FSC Auftragsdokumentation</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
    border-radius: 16px;
    background: #f9fafb;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }
  h1 { text-align: center; margin-bottom: 20px; }
  label { display: block; margin-top: 12px; font-weight: 600; }
  input, select {
    width: 100%; padding: 6px; margin-top: 4px;
    border: 1px solid #ccc; border-radius: 6px;
  }
  .component { 
    margin-top: 20px; 
    padding: 15px; 
    background: #fff; 
    border: 1px solid #ddd; 
    border-radius: 8px; 
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background: #1e40af; }
</style>
</head>
<body>

<h1>FSC Auftragsdokumentation</h1>

<form id="fscForm">
  <label>Bearbeiter</label>
  <select name="bearbeiter" required>
    <option value="">Bitte w√§hlen</option>
    <option value="Michael Schmid">Michael Schmid</option>
    <option value="Marcus Kalle">Marcus Kalle</option>
  </select>

  <label>Auftragsnummer</label>
  <input type="text" name="auftragsnummer" required>

  <label>Kundenname</label>
  <input type="text" name="kunde" required>

  <label>Bezeichnung des Auftrags</label>
  <input type="text" name="bezeichnung" required>

  <label>Endformat Breite (mm)</label>
  <input type="number" name="end_breite" required>

  <label>Endformat H√∂he (mm)</label>
  <input type="number" name="end_hoehe" required>

  <label>Bestellte Auflage</label>
  <input type="number" name="auflage" required>

  <label>Anzahl der Komponenten (1‚Äì5)</label>
  <select id="komponentenAnzahl" required>
    <option value="">Bitte w√§hlen</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>

  <div id="komponentenContainer"></div>

  <button type="submit">Speichern</button>
</form>

<script>
  const select = document.getElementById('komponentenAnzahl');
  const container = document.getElementById('komponentenContainer');
  let materialien = [];

  // Materialliste laden
  async function ladeMaterialien() {
    try {
      const res = await fetch('fsc-materialien.json');
      if (!res.ok) throw new Error("Materialliste konnte nicht geladen werden");
      materialien = await res.json();
    } catch (err) {
      console.error(err);
      alert("Fehler beim Laden der FSC-Materialliste.");
    }
  }

  ladeMaterialien().then(() => {
    console.log("FSC-Materialien geladen:", materialien);
  });

  select.addEventListener('change', () => {
    container.innerHTML = '';
    const anzahl = parseInt(select.value);
    if (!anzahl) return;

    for (let i = 1; i <= anzahl; i++) {
      const div = document.createElement('div');
      div.classList.add('component');

      // Dropdown-Optionen dynamisch generieren
      const materialOptions = materialien
        .map(m => `<option value="${m}">${m}</option>`)
        .join('');

      div.innerHTML = `
        <h3>Komponente ${i}</h3>

        <label>Bezeichnung der Komponente</label>
        <input type="text" name="komponente_${i}_bezeichnung" required>

        <label>Papierbezeichnung</label>
        <select name="komponente_${i}_material" required>
          <option value="">Bitte w√§hlen</option>
          ${materialOptions}
        </select>

        <label>Grammatur (g/m¬≤)</label>
        <input type="number" name="komponente_${i}_grammatur" required>

        <label>Anzahl Seiten</label>
        <input type="number" name="komponente_${i}_seiten" required>

        <label>Seiten pro Druckbogen</label>
        <input type="number" name="komponente_${i}_seiten_pro_bogen" required>

        <label>Brutto Eingangsbreite (mm)</label>
        <input type="number" name="komponente_${i}_eingangsbreite" required>

        <label>Brutto Eingangsh√∂he (mm)</label>
        <input type="number" name="komponente_${i}_eingangshoehe" required>

        <label>FSC Zertifikat</label>
        <select name="komponente_${i}_fsc_zertifikat" required>
          <option value="">Bitte w√§hlen</option>
          <option value="FSC 100%">FSC 100%</option>
          <option value="FSC Recycled">FSC Recycled</option>
          <option value="FSC Mix">FSC Mix</option>
        </select>
      `;
      container.appendChild(div);
    }
  });

  document.getElementById('fscForm').addEventListener('submit', async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    console.log('FSC Auftrag:', data);

    // === üëá HIER deine n8n-Adresse eintragen ========================
    const webhookUrl = "https://app.n8n.cloud/webhook-test/fscauftrag";
    // ===============================================================

    try {
      const res = await fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        alert("Auftrag erfolgreich an n8n gesendet ‚úÖ");
        e.target.reset();
        container.innerHTML = '';
      } else {
        alert("Fehler beim Senden an n8n ‚ùå");
      }
    } catch (err) {
      alert("Verbindungsfehler: " + err.message);
    }
  });
</script>

</body>
</html>
